# pose-emti-v2

测圆（二值化版本）

**所用环境：**

    * vcpkg 
    * "Visual Studio 2019"
    * CMake

## Windows

下载Visual Studio 16 2019工具链，用vcpkg安装opencv4包，然后CMake编译生成

## Linux

设置USE_VCPKG=OFF，然后CMake编译生成

## 算法逻辑

1. 捕获原图片
2. 直方图均衡(均衡光照)
3. 二值化（自适应OTSU）
4. 中值滤波
5. 找轮廓
6. 过滤不必要的轮廓
    1. 父关系节点需要存在
    2. 滤过面积较小的斑点
    3. 滤过圆度不达标的图形
    4. 依照父关系节点归类
7. 拟合椭圆
8. 通过拟合椭圆结算真正的圆

算法6漏洞：并未通过9个圆点之间的相互位置进行过滤，一时这个算法不好写，写出来算法复杂度太高，时间上不占优势， 二者缺乏好的算法，比如如果存在角度该怎么办？

## 优化

### 健壮性优化

略过，暂时来说比v1版本好了不知道多少，不过导师说不行（吐槽：哪不行了，这个要不行原来那版本（论文）更加不行）

不过还是需要一个严格的证明...

### 速度优化

优化目标：最终目标30FPS，解算一张图片所需时间大约0.033s左右。现阶段优化目标时间`time consume < 0.1`
优化条件：不得使用包括GPU在内的任何硬件加速功能（艹）

**时间占比：**

|阶段|步骤|消耗时间|
| ---- |----|----|
|1|直方图均衡|0.008|
|2|二值化   |0.012|
|3|中值滤波 |0.14|
|4|寻找轮廓 |0.029|
|5|滤过轮廓 |0.003|
|6|拟合圆   |0s|
|7|总计    |0.207|


1. 阶段3中值滤波所占时间较长，应该划为主要优化目标
2. 如果去掉中值滤波，阶段4，5时间上都会有明显的增加
3. 中值滤波主要是为了应对图片上许多模糊的点（可以视作椒盐噪声）
